# Ray Tracing

Offline rendering application by ray tracing.

### Features

- Spatial data structure (k-d tree)
- Photon mapping
- Procedural texture

## Requirements

C++14 or higher. Tested on MSVC v141, no tested on other comilper yet. 

- [hlsl++](https://github.com/redorav/hlslpp)    Vector, Matrix library provided a HLSL like syntax.
- [libpng](http://www.libpng.org/pub/png/libpng.html)    Library to handle .PNG file.
- [png++](https://www.nongnu.org/pngpp/)   C++ wrapper for libpng library.

## Scene

![scene](https://raw.githubusercontent.com/CJT-Jackton/RayTracing/master/Screenshots/Capture1.png "Scene")
    *Example scene generated by Unity*

#### Objects

1. **Floor (Plane with checkerboard texture)**

    | Parameter  | Value      |
    | :--------- | :--------- |
    | position   | (0, 0, 0)  |
    | size       | 10, 0, 20  |

2. **Sphere (Transparent)**

    | Parameter  | Value      |
    | :--------- | :--------- |
    | position   | (-3.413, 1.326, -9.88)  |
    | radius     | 0.5        |

3. **Sphere (Metal)**

    | Parameter  | Value      |
    | :--------- | :--------- |
    | position   | (-2.628, 0.949, -8.732)  |
    | radius     | 0.5        |

#### Camera

| Parameter     | Value      |
| :------------ | :--------- |
| position      | (-3.428, 1.283, -12.022)  |
| direction     | (0, 0, 1)  |
| field of view | 60         |

#### Light Source

| Parameter  | Value             |
| :--------- | :---------------- |
| type       | directional light |
| direction  | (40, 15, 0)       |

###### Note
> Every value above are in left-hand coordinate system.

## Color

![color buffer](https://raw.githubusercontent.com/CJT-Jackton/RayTracing/master/Screenshots/Checkpoint2.png "Color buffer")
    *Color Buffer of the Scene*
    
The color buffer above doesn't represent the actual color of the object, instead it just for distinguish different object in the scene.

![depth buffer](https://raw.githubusercontent.com/CJT-Jackton/RayTracing/master/Screenshots/RayTracingScene_depth.png "Depth buffer")
    *Depth Buffer of the Scene*
    
### Extra

![cube](https://raw.githubusercontent.com/CJT-Jackton/RayTracing/master/Screenshots/Checkpoint2_extra1.png "Cube")
    *Cube primitive*
    
![another camera angle](https://raw.githubusercontent.com/CJT-Jackton/RayTracing/master/Screenshots/Checkpoint2_extra2.png "Another Camera Angle")
    *Scene Rendered From Another Camera*

## Shading

### Phong shading model

![phong](https://raw.githubusercontent.com/CJT-Jackton/RayTracing/master/Screenshots/Checkpoint3_Phong_colored.png "Phong Shading")

![phong](https://raw.githubusercontent.com/CJT-Jackton/RayTracing/master/Screenshots/Checkpoint3_Phong.png "Phong Shading")

Without color.

![more light source](https://raw.githubusercontent.com/CJT-Jackton/RayTracing/master/Screenshots/Checkpoint3_multiple_lightsources.png "Phong Shading")

Add more light.

![more light source](https://raw.githubusercontent.com/CJT-Jackton/RayTracing/master/Screenshots/Checkpoint3_multiple_lightsources2.png "Phong Shading")

View from another angle.

### Blinn-Phong shading model

![blinn-phong](https://raw.githubusercontent.com/CJT-Jackton/RayTracing/master/Screenshots/Checkpoint3_Blinn-Phong_colored.png "Blinn-Phong Shading")

![blinn-phong](https://raw.githubusercontent.com/CJT-Jackton/RayTracing/master/Screenshots/Checkpoint3_Blinn-Phong.png "Blinn-Phong Shading")

Without color.

## Texture

![Texture](https://raw.githubusercontent.com/CJT-Jackton/RayTracing/master/Screenshots/Texture_Bilinear.png "Texture mapping")

### Procedural Texture

#### Checkerboard 2D

![Checkerboard 2D](https://raw.githubusercontent.com/CJT-Jackton/RayTracing/master/Screenshots/Procedural_Texture_Checkerboard2D.png "Procedural Texture Checkerboard2D")

#### Perlin noise

![Perlin noise](https://raw.githubusercontent.com/CJT-Jackton/RayTracing/master/Screenshots/Procedural_Texture_Perlin_Noise.png "Procedural Texture Perlin Noise")

## Anti-aliasing

Multisample anti-aliasing with 4 rays per pixel.
After tried out multiple sampling pattern, I found 4-Rooks pattern (Rotated grid supersampling) produced the best result in visual.

![NoAA](https://raw.githubusercontent.com/CJT-Jackton/RayTracing/master/Screenshots/Checkpoint3_NoAA.png "No Anti-aliasing")

No anti-aliasing.

![MSAA4x](https://raw.githubusercontent.com/CJT-Jackton/RayTracing/master/Screenshots/Checkpoint3_MSAA4x.png "Multisample Anti-aliasing")

With MSAA4x anti-aliasing.

![NoAA vs MSAA4x](https://raw.githubusercontent.com/CJT-Jackton/RayTracing/master/Screenshots/Checkpoint3_NoAAvsMSAA4x.png "NoAA vs MSAA4x")

Side by side comparison.

## Tone mapping

There are multiple ways to convert the HDR image into LDR space. However the ACES film tone mapping is the most widely accepted and used tone mapping algorithm.

### ACES film tone mapping

```hlsl
float3 ACESFilm( float3 x ) {
    float a = 2.51f;
    float b = 0.03f;
    float c = 2.43f;
    float d = 0.59f;
    float e = 0.14f;
    return saturate( ( x * ( a * x + b ) ) / ( x * ( c * x + d ) + e ) );
}
```

Code and coefficients are from [Krzysztof Narkowicz](https://knarkowicz.wordpress.com/2016/01/06/aces-filmic-tone-mapping-curve/).

## Author
Jietong Chen
